#!/bin/bash

echo "Running pre-commit using workspace venv..."

# Get the project root directory
REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT" || exit 1

# Use the workspace venv directly
VENV_PATH="${REPO_ROOT}/venv"
if [ ! -d "$VENV_PATH" ]; then
    echo "Error: Workspace venv not found at ${VENV_PATH}"
    exit 1
fi

# Export PATH to use venv's Python first
export PATH="${VENV_PATH}/bin:$PATH"

# Check if pre-commit exists in venv
if ! command -v pre-commit &>/dev/null; then
    echo "Installing pre-commit in venv..."
    "${VENV_PATH}/bin/pip" install pre-commit
fi

echo "Using Python: $(python --version)"
echo "Running pre-commit from: $(which pre-commit)"

# Run pre-commit using venv
pre-commit run

exit $?

